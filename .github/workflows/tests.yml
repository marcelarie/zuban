name: Tests

on:
  workflow_call:

defaults:
  run:
    shell: bash

jobs:
  cargo-test-debug:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os:
          # Maybe avoid Mac here for now, because the CI is costly (10x of linux)
          - macos-latest
          - ubuntu-24.04
          - windows-2022
    timeout-minutes: 20
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: recursive
          persist-credentials: false
      - uses: Swatinem/rust-cache@v2
      - name: "Run tests"
        run: |
          ./scripts/ci-test.sh

  cargo-test-linux-release:
    name: "cargo test (linux, release)"
    runs-on: ubuntu-24.04
    timeout-minutes: 20
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: recursive
          persist-credentials: false
      - uses: Swatinem/rust-cache@v2
      - name: "Run tests"
        run: |
            rustup show
            cargo test --release --locked
